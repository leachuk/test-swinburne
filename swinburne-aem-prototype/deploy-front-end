#!/bin/bash

# Check if Sync directory exists
if [ ! -d "sync/" ]; then
  echo Directory sync/ not found, run \"npm run aem:checkout\"vi a
  exit
fi

VERSION=$1;

if [ ! $VERSION ]; then
  echo No Version found. Run again and pass in version. Eg: \"./deploy-frontend microsites\"
  exit
fi

echo Deploying version $VERSION

# TODO: Remove this and extract folder name from POM file
CLIENT_LIBS_FOLDER="swinburne"

echo Copying files from public to sync
cp -r public/${VERSION}/css/ sync/jcr_root/etc/clientlibs/${CLIENT_LIBS_FOLDER}/css/
cp -fR public/${VERSION}/js/ sync/jcr_root/etc/clientlibs/${CLIENT_LIBS_FOLDER}/js/
cp -r public/${VERSION}/images/ sync/jcr_root/etc/clientlibs/${CLIENT_LIBS_FOLDER}/images/
cp -r public/${VERSION}/fonts/ sync/jcr_root/etc/clientlibs/${CLIENT_LIBS_FOLDER}/fonts/

echo Launching VLT
cd sync && ../tools/vault-cli/bin/vlt --verbose --credentials admin:admin ci --force  ./jcr_root/etc/clientlibs/${CLIENT_LIBS_FOLDER}
